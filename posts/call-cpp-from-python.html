<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>在 python 中调用 c++ | 梦飞翔的小站</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/assets/style.90649a90.css">
    <link rel="modulepreload" href="/assets/app.48fcf0fc.js">
    <link rel="modulepreload" href="/assets/posts_call-cpp-from-python.md.6c2f62e5.lean.js">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/regular.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC">
  <script src="https://cdn.jsdelivr.net/npm/@waline/client@1.5.4/dist/Waline.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><!--[--><header><span class="brand"></span><span class="container"><span class="nav"></span><span class="menu"><ul><!--[--><li><a href="/"><span><i class="fa fa-home"></i> 首页</span></a></li><li><a href="/tags/"><span><i class="fa fa-tag"></i> 标签</span></a></li><li><a href="/readme.html"><span><i class="fa fa-leaf"></i> 关于</span></a></li><!--]--></ul></span></span><span><span class="search"><i class="fa fa-search"></i></span></span></header><aside></aside><main><a href="#" class="totop" style="top:-900px;" aria-label="to-top"></a><!--[--><div class="abanner" style="background-image: url(https://tva4.sinaimg.cn/large/0060lm7Tly1ftg6omnqa4j31hc0u010z.jpg)"><div class="titlebox"><h1 class="title">在 python 中调用 c++</h1><div class="info">flaribbit · 更新于 2022-05-08 · 0 次阅读</div></div></div><div class="article"><div style="position:relative;" class="content"><div><p>剧透：SWIG</p><hr><h2 id="准备" tabindex="-1">准备 <a class="header-anchor" href="#准备" aria-hidden="true">#</a></h2><p><a href="https://swig.org/" target="_blank" rel="noreferrer">SWIG 官网</a>可以下载到可执行文件。</p><p>这里给出一个示例头文件：<code>lib.h</code></p><div class="language-cpp line-numbers-mode"><button class="copy"></button><span class="lang">cpp</span><pre><code><span class="line"><span style="color:#CF222E;">#include</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&lt;string&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#CF222E;">class</span><span style="color:#24292F;"> </span><span style="color:#953800;">Person</span><span style="color:#24292F;"> {</span></span>
<span class="line"><span style="color:#24292F;">   </span><span style="color:#CF222E;">public:</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">std</span><span style="color:#24292F;">::string name;</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">int</span><span style="color:#24292F;"> age;</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#8250DF;">Person</span><span style="color:#24292F;">(</span><span style="color:#953800;">std</span><span style="color:#24292F;">::</span><span style="color:#953800;">string</span><span style="color:#24292F;"> </span><span style="color:#953800;">name</span><span style="color:#24292F;">, </span><span style="color:#CF222E;">int</span><span style="color:#24292F;"> </span><span style="color:#953800;">age</span><span style="color:#24292F;">);</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#953800;">std</span><span style="color:#24292F;">::</span><span style="color:#953800;">string</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">getName</span><span style="color:#24292F;">();</span></span>
<span class="line"><span style="color:#24292F;">    </span><span style="color:#CF222E;">int</span><span style="color:#24292F;"> </span><span style="color:#8250DF;">getAge</span><span style="color:#24292F;">();</span></span>
<span class="line"><span style="color:#24292F;">};</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="编写-i-文件" tabindex="-1">编写 .i 文件 <a class="header-anchor" href="#编写-i-文件" aria-hidden="true">#</a></h2><p><code>lib.i</code></p><div class="language-cpp line-numbers-mode"><button class="copy"></button><span class="lang">cpp</span><pre><code><span class="line"><span style="color:#CF222E;">%module</span><span style="color:#24292F;"> Person</span></span>
<span class="line"><span style="color:#CF222E;">%</span><span style="color:#24292F;">include </span><span style="color:#0A3069;">&quot;std_string.i&quot;</span></span>
<span class="line"><span style="color:#CF222E;">%</span><span style="color:#24292F;">{</span></span>
<span class="line"><span style="color:#CF222E;">#include</span><span style="color:#24292F;"> </span><span style="color:#0A3069;">&quot;lib.h&quot;</span></span>
<span class="line"><span style="color:#CF222E;">%</span><span style="color:#24292F;">}</span></span>
<span class="line"><span style="color:#CF222E;">using</span><span style="color:#24292F;"> </span><span style="color:#CF222E;">namespace</span><span style="color:#24292F;"> </span><span style="color:#953800;">std</span><span style="color:#24292F;">;</span></span>
<span class="line"><span style="color:#CF222E;">%</span><span style="color:#24292F;">include </span><span style="color:#0A3069;">&quot;lib.h&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>其中 module 对应编译得到的 python 模块名。因为我这里用到了 <code>std::string</code>，所以还要引入对应的声明文件 <code>std_string.i</code>，如果用了其他容器也类似。</p><h2 id="使用-swig-编译-i-文件" tabindex="-1">使用 SWIG 编译 .i 文件 <a class="header-anchor" href="#使用-swig-编译-i-文件" aria-hidden="true">#</a></h2><p>一行简简单单的命令：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#24292F;">swig.exe -c++ -python lib.i</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>编译后会生成两个文件：</p><ul><li><code>lib_wrap.cxx</code>（文件名取决于头文件）</li><li><code>Person.py</code>（文件名取决于 module）</li></ul><h2 id="编译源文件和-wrap-文件" tabindex="-1">编译源文件和 wrap 文件 <a class="header-anchor" href="#编译源文件和-wrap-文件" aria-hidden="true">#</a></h2><p>这次头铁，使用了不熟悉的 msvc 编译器，命令如下：</p><div class="language-bash line-numbers-mode"><button class="copy"></button><span class="lang">bash</span><pre><code><span class="line"><span style="color:#24292F;">cl lib.cpp lib_wrap.cxx /LD /IC:</span><span style="color:#0550AE;">\T</span><span style="color:#24292F;">ools</span><span style="color:#0550AE;">\P</span><span style="color:#24292F;">ython</span><span style="color:#0550AE;">\i</span><span style="color:#24292F;">nclude /link /LIBPATH:C:</span><span style="color:#0550AE;">\T</span><span style="color:#24292F;">ools</span><span style="color:#0550AE;">\P</span><span style="color:#24292F;">ython</span><span style="color:#0550AE;">\l</span><span style="color:#24292F;">ibs</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>/LD</code> 相当于 gcc 的 <code>-shared</code>，表示生成动态链接库</li><li><code>/I</code> 相当于 gcc 的 <code>-I</code></li><li><code>/link /LIBPATH:</code> 相当于 gcc 的 <code>-L</code></li></ul><p>然后把生成的文件重命名为 <code>_Person.pyd</code>，这样就可以被 SWIG 生成的 <code>Person.py</code> 调用了。</p><h2 id="在-python-中调用" tabindex="-1">在 python 中调用 <a class="header-anchor" href="#在-python-中调用" aria-hidden="true">#</a></h2><p>这一步没什么好说的，把他当成正常的 python 类就好了。</p><div class="language-py line-numbers-mode"><button class="copy"></button><span class="lang">py</span><pre><code><span class="line"><span style="color:#CF222E;">import</span><span style="color:#24292F;"> Person</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292F;">p </span><span style="color:#CF222E;">=</span><span style="color:#24292F;"> Person.Person(</span><span style="color:#0A3069;">&quot;John&quot;</span><span style="color:#24292F;">, </span><span style="color:#0550AE;">20</span><span style="color:#24292F;">)</span></span>
<span class="line"><span style="color:#0550AE;">print</span><span style="color:#24292F;">(p.getName())</span></span>
<span class="line"><span style="color:#0550AE;">print</span><span style="color:#24292F;">(p.getAge())</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><div class="content nav"><span><a href="/posts/ripple-animation.html"><i class="fa fa-angle-left"></i> 水波纹效果</a></span><span><a href="/posts/pyside2-quick-start.html">pyside2 快速入门 <i class="fa fa-angle-right"></i></a></span></div><div id="waline"></div><div class="toc"><ol><!--[--><li class="h2 active"><a href="#准备">准备</a></li><li class="h2"><a href="#编写-i-文件">编写 .i 文件</a></li><li class="h2"><a href="#使用-swig-编译-i-文件">使用 SWIG 编译 .i 文件</a></li><li class="h2"><a href="#编译源文件和-wrap-文件">编译源文件和 wrap 文件</a></li><li class="h2"><a href="#在-python-中调用">在 python 中调用</a></li><!--]--></ol></div></div><!--]--></main><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"6e998797\",\"posts_algorithm-2048.md\":\"a6407823\",\"posts_algorithm-template.md\":\"7029899f\",\"posts_ascii-art.md\":\"b60126d2\",\"posts_calc-demo.md\":\"5d1d3f62\",\"posts_call-cpp-from-python.md\":\"6c2f62e5\",\"posts_cpp-promise.md\":\"d4bc0aa1\",\"posts_d3-note.md\":\"65464f4b\",\"posts_fix-matplotlib-chinese.md\":\"98231661\",\"posts_indexeddb.md\":\"1ab0dbb0\",\"posts_love2d-require-c-library.md\":\"651bc64b\",\"posts_new-to-arch.md\":\"18c6d223\",\"posts_pattern-recognition-note.md\":\"16ca63b2\",\"posts_pyside2-quick-start.md\":\"d4e2e283\",\"posts_python-opencv.md\":\"ab5e5ebc\",\"posts_ripple-animation.md\":\"9aceacaf\",\"posts_rust-list-slice.md\":\"4e48ff46\",\"posts_tensorflow-note.md\":\"592157a3\",\"posts_tetris-field-compress.md\":\"d7021d16\",\"posts_write-code-from-answer.md\":\"c45d8f6d\",\"posts_xjb-utils.md\":\"c4ac2148\",\"readme.md\":\"010b0200\",\"tags_index.md\":\"328f7df2\"}")</script>
    <script type="module" async src="/assets/app.48fcf0fc.js"></script>
    
  </body>
</html>