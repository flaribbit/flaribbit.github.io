<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>在 python 中调用 c++ | 梦飞翔的小站</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/assets/style.0565aa79.css">
    <link rel="modulepreload" href="/assets/app.3f9f9bc9.js">
    <link rel="modulepreload" href="/assets/posts_call-cpp-from-python.md.3ea81704.lean.js">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/regular.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC">
  <script src="https://cdn.jsdelivr.net/npm/@waline/client@1.5.4/dist/Waline.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css">
  <meta name="twitter:title" content="在 python 中调用 c++ | 梦飞翔的小站">
  <meta property="og:title" content="在 python 中调用 c++ | 梦飞翔的小站">
  </head>
  <body>
    <div id="app"><!--[--><header><span class="brand"></span><span class="container"><span class="nav"></span><span class="menu"><ul><!--[--><li><a href="/"><span><i class="fa fa-home"></i> 首页</span></a></li><li><a href="/tags/"><span><i class="fa fa-tag"></i> 标签</span></a></li><li><a href="/readme.html"><span><i class="fa fa-leaf"></i> 关于</span></a></li><!--]--></ul></span></span><span><span class="search"><i class="fa fa-search"></i></span></span></header><aside></aside><main><a href="#" class="totop" style="top:-900px;" aria-label="to-top"></a><!--[--><div class="abanner" style="background-image: url(https://tva4.sinaimg.cn/large/0060lm7Tly1ftg6omnqa4j31hc0u010z.jpg)"><div class="titlebox"><h1 class="title">在 python 中调用 c++</h1><div class="info">flaribbit · 更新于 Invalid Date · 0 次阅读</div></div></div><div class="article"><div style="position:relative;" class="content"><div><p>剧透：SWIG</p><hr><h2 id="准备" tabindex="-1">准备 <a class="header-anchor" href="#准备" aria-hidden="true">#</a></h2><p><a href="https://swig.org/" target="_blank" rel="noopener noreferrer">SWIG 官网</a>可以下载到可执行文件。</p><p>这里给出一个示例头文件：<code>lib.h</code></p><div class="language-cpp line-numbers-mode"><pre><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
   <span class="token keyword">public</span><span class="token operator">:</span>
    std<span class="token double-colon punctuation">::</span>string name<span class="token punctuation">;</span>
    <span class="token keyword">int</span> age<span class="token punctuation">;</span>
    <span class="token function">Person</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>string name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> <span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="编写-i-文件" tabindex="-1">编写 .i 文件 <a class="header-anchor" href="#编写-i-文件" aria-hidden="true">#</a></h2><p><code>lib.i</code></p><div class="language-cpp line-numbers-mode"><pre><code><span class="token operator">%</span><span class="token keyword">module</span> <span class="token module">Person</span>
<span class="token operator">%</span>include <span class="token string">&quot;std_string.i&quot;</span>
<span class="token operator">%</span><span class="token punctuation">{</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&quot;lib.h&quot;</span></span>
<span class="token operator">%</span><span class="token punctuation">}</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token operator">%</span>include <span class="token string">&quot;lib.h&quot;</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>其中 module 对应编译得到的 python 模块名。因为我这里用到了 <code>std::string</code>，所以还要引入对应的声明文件 <code>std_string.i</code>，如果用了其他容器也类似。</p><h2 id="使用-swig-编译-i-文件" tabindex="-1">使用 SWIG 编译 .i 文件 <a class="header-anchor" href="#使用-swig-编译-i-文件" aria-hidden="true">#</a></h2><p>一行简简单单的命令：</p><div class="language-sh line-numbers-mode"><pre><code>swig.exe -c++ -python lib.i
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>编译后会生成两个文件：</p><ul><li><code>lib_wrap.cxx</code>（文件名取决于头文件）</li><li><code>Person.py</code>（文件名取决于 module）</li></ul><h2 id="编译源文件和-wrap-文件" tabindex="-1">编译源文件和 wrap 文件 <a class="header-anchor" href="#编译源文件和-wrap-文件" aria-hidden="true">#</a></h2><p>这次头铁，使用了不熟悉的 msvc 编译器，命令如下：</p><div class="language-sh line-numbers-mode"><pre><code>cl lib.cpp lib_wrap.cxx /LD /IC:\Tools\Python\include /link /LIBPATH:C:\Tools\Python\libs
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>/LD</code> 相当于 gcc 的 <code>-shared</code>，表示生成动态链接库</li><li><code>/I</code> 相当于 gcc 的 <code>-I</code></li><li><code>/link /LIBPATH:</code> 相当于 gcc 的 <code>-L</code></li></ul><p>然后把生成的文件重命名为 <code>_Person.pyd</code>，这样就可以被 SWIG 生成的 <code>Person.py</code> 调用了。</p><h2 id="在-python-中调用" tabindex="-1">在 python 中调用 <a class="header-anchor" href="#在-python-中调用" aria-hidden="true">#</a></h2><p>这一步没什么好说的，把他当成正常的 python 类就好了。</p><div class="language-py line-numbers-mode"><pre><code><span class="token keyword">import</span> Person

p <span class="token operator">=</span> Person<span class="token punctuation">.</span>Person<span class="token punctuation">(</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>getName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>getAge<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div></div><div class="content nav"><span><a href="/posts/calc-demo.html"><i class="fa fa-angle-left"></i> 计算器demo</a></span><span><a href="/posts/cpp-promise.html">c++ promise future 初体验 <i class="fa fa-angle-right"></i></a></span></div><div id="waline"></div><div class="toc"><ol><!--[--><li class="h2 active"><a href="#准备">准备</a></li><li class="h2"><a href="#编写-i-文件">编写 .i 文件</a></li><li class="h2"><a href="#使用-swig-编译-i-文件">使用 SWIG 编译 .i 文件</a></li><li class="h2"><a href="#编译源文件和-wrap-文件">编译源文件和 wrap 文件</a></li><li class="h2"><a href="#在-python-中调用">在 python 中调用</a></li><!--]--></ol></div></div><!--]--></main><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"33941f6e\",\"posts_ascii-art.md\":\"1a95c566\",\"posts_calc-demo.md\":\"133a6ce1\",\"posts_call-cpp-from-python.md\":\"3ea81704\",\"posts_cpp-promise.md\":\"569a9f1d\",\"posts_d3-note.md\":\"47f93b83\",\"posts_fix-matplotlib-chinese.md\":\"a514191a\",\"posts_indexeddb.md\":\"3daec060\",\"posts_love2d-require-c-library.md\":\"9369d7c9\",\"posts_pattern-recognition-note.md\":\"3a49c40d\",\"posts_pyside2-quick-start.md\":\"c457ddfb\",\"posts_ripple-animation.md\":\"78a52710\",\"posts_rust-list-slice.md\":\"532edefc\",\"posts_tensorflow-note.md\":\"9278af91\",\"posts_tetris-field-compress.md\":\"89b50e7f\",\"posts_write-code-from-answer.md\":\"bee7fbcf\",\"posts_xjb-utils.md\":\"088f780b\",\"readme.md\":\"3750d4f0\",\"tags_index.md\":\"1474f0ff\"}")</script>
    <script type="module" async src="/assets/app.3f9f9bc9.js"></script>
    
  </body>
</html>