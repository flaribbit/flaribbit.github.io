<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TensorFlow 2.0 快速入门笔记 | 梦飞翔的小站</title>
    <meta name="description" content="A VitePress site">
    <link rel="stylesheet" href="/assets/style.0565aa79.css">
    <link rel="modulepreload" href="/assets/app.a584d98d.js">
    <link rel="modulepreload" href="/assets/posts_tensorflow-note.md.05b29c1d.lean.js">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/regular.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+SC">
  <script src="https://cdn.jsdelivr.net/npm/@waline/client@1.5.4/dist/Waline.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css">
  <meta name="twitter:title" content="TensorFlow 2.0 快速入门笔记 | 梦飞翔的小站">
  <meta property="og:title" content="TensorFlow 2.0 快速入门笔记 | 梦飞翔的小站">
  </head>
  <body>
    <div id="app"><!--[--><header><span class="brand"></span><span class="container"><span class="nav"></span><span class="menu"><ul><!--[--><li><a href="/"><span><i class="fa fa-home"></i> 首页</span></a></li><li><a href="/tags/"><span><i class="fa fa-tag"></i> 标签</span></a></li><li><a href="/readme.html"><span><i class="fa fa-leaf"></i> 关于</span></a></li><!--]--></ul></span></span><span><span class="search"><i class="fa fa-search"></i></span></span></header><aside></aside><main><a href="#" class="totop" style="top:-900px;" aria-label="to-top"></a><!--[--><div class="abanner" style="background-image: url(https://tva4.sinaimg.cn/large/0060lm7Tly1ftg6omnqa4j31hc0u010z.jpg)"><div class="titlebox"><h1 class="title">TensorFlow 2.0 快速入门笔记</h1><div class="info">flaribbit · 更新于 2021-08-16 · 0 次阅读</div></div></div><div class="article"><div style="position:relative;" class="content"><div><h2 id="使用-pip-安装-tensorflow" tabindex="-1">使用 pip 安装 TensorFlow <a class="header-anchor" href="#使用-pip-安装-tensorflow" aria-hidden="true">#</a></h2><p><code>tensorflow</code>：支持 CPU 和 GPU 的最新稳定版（适用于 Ubuntu 和 Windows） <code>tf-nightly</code>：预览 build（不稳定）。Ubuntu 和 Windows 均包含 GPU 支持。</p><h3 id="_1-环境准备" tabindex="-1">1. 环境准备 <a class="header-anchor" href="#_1-环境准备" aria-hidden="true">#</a></h3><p>检查 <code>python</code> 和 <code>pip</code> 命令是否可用。</p><h3 id="_2-创建虚拟环境（推荐）" tabindex="-1">2. 创建虚拟环境（推荐） <a class="header-anchor" href="#_2-创建虚拟环境（推荐）" aria-hidden="true">#</a></h3><p>Python 虚拟环境用于将软件包安装与系统隔离开来。</p><div class="language-bash line-numbers-mode"><pre><code>python -m venv .<span class="token punctuation">\</span>venv
.<span class="token punctuation">\</span>venv<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>activate
python -m pip <span class="token function">install</span> --upgrade pip
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>退出虚拟环境</p><div class="language-bash line-numbers-mode"><pre><code>deactivate
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-安装-tensorflow-pip-软件包" tabindex="-1">3. 安装 TensorFlow pip 软件包 <a class="header-anchor" href="#_3-安装-tensorflow-pip-软件包" aria-hidden="true">#</a></h3><p>在虚拟环境中执行</p><div class="language-bash line-numbers-mode"><pre><code>pip <span class="token function">install</span> tensorflow
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>测试环境</p><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">print</span><span class="token punctuation">(</span>tf<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 期望输出 tf.Tensor([3 3 8 7], shape=(4,), dtype=int32)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="tensorflow2-快速入门" tabindex="-1">TensorFlow2 快速入门 <a class="header-anchor" href="#tensorflow2-快速入门" aria-hidden="true">#</a></h2><p><a href="https://github.com/czy36mengfei/tensorflow2_tutorials_chinese/blob/master/001-keras_overview.ipynb" target="_blank" rel="noopener noreferrer">参考文档</a></p><p>TensorFlow2推荐使用tf.keras构建网络，常见的神经网络都包含在tf.keras.layer中(最新的tf.keras的版本可能和keras不同)</p><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">from</span> tensorflow<span class="token punctuation">.</span>keras <span class="token keyword">import</span> layers
<span class="token keyword">print</span><span class="token punctuation">(</span>tf<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_1-模型构建" tabindex="-1">1. 模型构建 <a class="header-anchor" href="#_1-模型构建" aria-hidden="true">#</a></h3><p>最常见的模型类型是层的堆叠：<code>tf.keras.Sequential</code> 模型</p><div class="language-python line-numbers-mode"><pre><code>model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;relu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;relu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;softmax&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>也可以直接放入 list 中</p><div class="language-python line-numbers-mode"><pre><code>model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">[</span>
  layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;relu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;relu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;softmax&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_2-参数配置" tabindex="-1">2. 参数配置 <a class="header-anchor" href="#_2-参数配置" aria-hidden="true">#</a></h3><p>tf.keras.layers中主要的网络配置参数如下：</p><ul><li><code>activation</code>：设置层的激活函数。此参数可以是函数名称字符串，也可以是函数对象。默认情况下，系统不会应用任何激活函数。</li><li><code>kernel_initializer</code> 和 <code>bias_initializer</code>：创建层权重（核和偏置）的初始化方案。此参数是一个名称或可调用的函数对象，默认为 &quot;Glorot uniform&quot; 初始化器。</li><li><code>kernel_regularizer</code> 和 <code>bias_regularizer</code>：应用层权重（核和偏置）的正则化方案，例如 L1 或 L2 正则化。默认情况下，系统不会应用正则化函数。</li></ul><div class="language-python line-numbers-mode"><pre><code>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;sigmoid&#39;</span><span class="token punctuation">)</span>
layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> activation<span class="token operator">=</span>tf<span class="token punctuation">.</span>sigmoid<span class="token punctuation">)</span>
layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> kernel_initializer<span class="token operator">=</span><span class="token string">&#39;orthogonal&#39;</span><span class="token punctuation">)</span>
layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> kernel_initializer<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>initializers<span class="token punctuation">.</span>glorot_normal<span class="token punctuation">)</span>
layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> kernel_regularizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>regularizers<span class="token punctuation">.</span>l2<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> kernel_regularizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>regularizers<span class="token punctuation">.</span>l1<span class="token punctuation">(</span><span class="token number">0.01</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_3-训练和评估" tabindex="-1">3. 训练和评估 <a class="header-anchor" href="#_3-训练和评估" aria-hidden="true">#</a></h3><h4 id="训练配置" tabindex="-1">训练配置 <a class="header-anchor" href="#训练配置" aria-hidden="true">#</a></h4><p>构建好模型后，通过调用 compile 方法配置该模型的学习流程：</p><div class="language-python line-numbers-mode"><pre><code>model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>optimizers<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             loss<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>categorical_crossentropy<span class="token punctuation">,</span>
             metrics<span class="token operator">=</span><span class="token punctuation">[</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>metrics<span class="token punctuation">.</span>categorical_accuracy<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="输入数据" tabindex="-1">输入数据 <a class="header-anchor" href="#输入数据" aria-hidden="true">#</a></h4><h5 id="小型数据" tabindex="-1">小型数据 <a class="header-anchor" href="#小型数据" aria-hidden="true">#</a></h5><p>使用 <code>numpy</code></p><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

train_x <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
train_y <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

val_x <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
val_y <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span>
          validation_data<span class="token operator">=</span><span class="token punctuation">(</span>val_x<span class="token punctuation">,</span> val_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="大型数据集" tabindex="-1">大型数据集 <a class="header-anchor" href="#大型数据集" aria-hidden="true">#</a></h5><p>使用 <code>tf.data</code> ，具体使用方法查阅 <code>tf.data.Dataset</code></p><div class="language-python line-numbers-mode"><pre><code>dataset <span class="token operator">=</span> tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slices<span class="token punctuation">(</span><span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
dataset <span class="token operator">=</span> dataset<span class="token punctuation">.</span>batch<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
dataset <span class="token operator">=</span> dataset<span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token punctuation">)</span>
val_dataset <span class="token operator">=</span> tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slices<span class="token punctuation">(</span><span class="token punctuation">(</span>val_x<span class="token punctuation">,</span> val_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
val_dataset <span class="token operator">=</span> val_dataset<span class="token punctuation">.</span>batch<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span>
val_dataset <span class="token operator">=</span> val_dataset<span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token punctuation">)</span>

model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> steps_per_epoch<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>
          validation_data<span class="token operator">=</span>val_dataset<span class="token punctuation">,</span> validation_steps<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="评估和预测" tabindex="-1">评估和预测 <a class="header-anchor" href="#评估和预测" aria-hidden="true">#</a></h4><p>评估和预测函数：<code>tf.keras.Model.evaluate</code> 和 <code>tf.keras.Model.predict</code> 方法，都可以可以使用NumPy和 <code>tf.data.Dataset</code> 构造的输入数据进行评估和预测</p><p>区别在于，<code>evaluate</code> 需要与真实标签比较预测效果，而 <code>predict</code> 只输出预测结果。</p><div class="language-python line-numbers-mode"><pre><code>test_x <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
test_y <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>test_x<span class="token punctuation">,</span> test_y<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
test_data <span class="token operator">=</span> tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slices<span class="token punctuation">(</span><span class="token punctuation">(</span>test_x<span class="token punctuation">,</span> test_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
test_data <span class="token operator">=</span> test_data<span class="token punctuation">.</span>batch<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span>test_data<span class="token punctuation">,</span> steps<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>

result <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_x<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_4-构建复杂模型" tabindex="-1">4. 构建复杂模型 <a class="header-anchor" href="#_4-构建复杂模型" aria-hidden="true">#</a></h3><h4 id="函数式api" tabindex="-1">函数式API <a class="header-anchor" href="#函数式api" aria-hidden="true">#</a></h4><p><code>tf.keras.Sequential</code> 模型是层的简单堆叠，无法表示任意模型。使用 Keras 的函数式 API 可以构建复杂的模型拓扑，例如：</p><ul><li>多输入模型，</li><li>多输出模型，</li><li>具有共享层的模型（同一层被调用多次），</li><li>具有非序列数据流的模型（例如，残差连接）。</li></ul><p>使用函数式 API 构建的模型具有以下特征：</p><ul><li>层实例可调用并返回张量。</li><li>输入张量和输出张量用于定义 <code>tf.keras.Model</code> 实例。</li><li>此模型的训练方式和 <code>Sequential</code> 模型一样。</li></ul><div class="language-python line-numbers-mode"><pre><code>input_x <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>Input<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">72</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
hidden1 <span class="token operator">=</span> layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;relu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>input_x<span class="token punctuation">)</span> <span class="token comment"># 表示与input_x连接</span>
hidden2 <span class="token operator">=</span> layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;relu&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>hidden1<span class="token punctuation">)</span>
pred <span class="token operator">=</span> layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;softmax&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span>hidden2<span class="token punctuation">)</span>
<span class="token comment"># 构建tf.keras.Model实例</span>
model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>Model<span class="token punctuation">(</span>inputs<span class="token operator">=</span>input_x<span class="token punctuation">,</span> outputs<span class="token operator">=</span>pred<span class="token punctuation">)</span>
model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>optimizers<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
             loss<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>categorical_crossentropy<span class="token punctuation">,</span>
             metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">&#39;accuracy&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h4 id="模型子类化" tabindex="-1">模型子类化 <a class="header-anchor" href="#模型子类化" aria-hidden="true">#</a></h4><p>不如上面的好看，具体见<a href="https://github.com/czy36mengfei/tensorflow2_tutorials_chinese/blob/master/001-keras_overview.ipynb" target="_blank" rel="noopener noreferrer">原文</a></p><h4 id="自定义层" tabindex="-1">自定义层 <a class="header-anchor" href="#自定义层" aria-hidden="true">#</a></h4><p>不如上面的好看，具体见<a href="https://github.com/czy36mengfei/tensorflow2_tutorials_chinese/blob/master/001-keras_overview.ipynb" target="_blank" rel="noopener noreferrer">原文</a></p><h4 id="回调" tabindex="-1">回调 <a class="header-anchor" href="#回调" aria-hidden="true">#</a></h4><p>回调是传递给模型以自定义和扩展其在训练期间的行为的对象。我们可以编写自己的自定义回调，或使用 <code>tf.keras.callbacks</code> 中的内置函数，常用内置回调函数如下：</p><ul><li><code>tf.keras.callbacks.ModelCheckpoint</code>：定期保存模型的检查点。</li><li><code>tf.keras.callbacks.LearningRateScheduler</code>：动态更改学习率。</li><li><code>tf.keras.callbacks.EarlyStopping</code>：验证性能停止提高时进行中断培训。</li><li><code>tf.keras.callbacks.TensorBoard</code>：使用 TensorBoard 监视模型的行为。</li></ul><div class="language-python line-numbers-mode"><pre><code>callbacks <span class="token operator">=</span> <span class="token punctuation">[</span>
    tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span>EarlyStopping<span class="token punctuation">(</span>patience<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> monitor<span class="token operator">=</span><span class="token string">&#39;val_loss&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span>TensorBoard<span class="token punctuation">(</span>log_dir<span class="token operator">=</span><span class="token string">&#39;./logs&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x<span class="token punctuation">,</span> train_y<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
         callbacks<span class="token operator">=</span>callbacks<span class="token punctuation">,</span> validation_data<span class="token operator">=</span><span class="token punctuation">(</span>val_x<span class="token punctuation">,</span> val_y<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_5-模型保存与恢复" tabindex="-1">5. 模型保存与恢复 <a class="header-anchor" href="#_5-模型保存与恢复" aria-hidden="true">#</a></h3><h4 id="保存权重" tabindex="-1">保存权重 <a class="header-anchor" href="#保存权重" aria-hidden="true">#</a></h4><div class="language-python line-numbers-mode"><pre><code>model<span class="token punctuation">.</span>save_weights<span class="token punctuation">(</span><span class="token string">&#39;./weights/model&#39;</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>load_weights<span class="token punctuation">(</span><span class="token string">&#39;./weights/model&#39;</span><span class="token punctuation">)</span>

<span class="token comment"># 或者保存为h5格式</span>
model<span class="token punctuation">.</span>save_weights<span class="token punctuation">(</span><span class="token string">&#39;./model.h5&#39;</span><span class="token punctuation">,</span> save_format<span class="token operator">=</span><span class="token string">&#39;h5&#39;</span><span class="token punctuation">)</span>
model<span class="token punctuation">.</span>load_weights<span class="token punctuation">(</span><span class="token string">&#39;./model.h5&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="保存网络结构" tabindex="-1">保存网络结构 <a class="header-anchor" href="#保存网络结构" aria-hidden="true">#</a></h4><p>json格式</p><div class="language-python line-numbers-mode"><pre><code><span class="token keyword">import</span> json
<span class="token keyword">import</span> pprint
json_str <span class="token operator">=</span> model<span class="token punctuation">.</span>to_json<span class="token punctuation">(</span><span class="token punctuation">)</span>
pprint<span class="token punctuation">.</span>pprint<span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 读取</span>
fresh_model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models<span class="token punctuation">.</span>model_from_json<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>yaml格式</p><div class="language-python line-numbers-mode"><pre><code>yaml_str <span class="token operator">=</span> model<span class="token punctuation">.</span>to_yaml<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>yaml_str<span class="token punctuation">)</span>

<span class="token comment"># 读取</span>
fresh_model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models<span class="token punctuation">.</span>model_from_yaml<span class="token punctuation">(</span>yaml_str<span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="保存整个模型" tabindex="-1">保存整个模型 <a class="header-anchor" href="#保存整个模型" aria-hidden="true">#</a></h4><div class="language-python line-numbers-mode"><pre><code>model<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">&#39;all_model.h5&#39;</span><span class="token punctuation">)</span>

<span class="token comment"># 读取</span>
model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models<span class="token punctuation">.</span>load_model<span class="token punctuation">(</span><span class="token string">&#39;all_model.h5&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="常用函数速查" tabindex="-1">常用函数速查 <a class="header-anchor" href="#常用函数速查" aria-hidden="true">#</a></h2><h3 id="常用-layer" tabindex="-1">常用 Layer <a class="header-anchor" href="#常用-layer" aria-hidden="true">#</a></h3><h4 id="dense-全连接层" tabindex="-1">Dense 全连接层 <a class="header-anchor" href="#dense-全连接层" aria-hidden="true">#</a></h4><p>进行 $f(wx+b)$ 运算</p><p><a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-rn6a2tps.html" target="_blank" rel="noopener noreferrer">参数</a></p><ul><li><code>units</code>：整数或长整数,输出空间的维数</li><li><code>activation</code>：激活功能(可调用),将其设置为“None”以保持线性激活.</li><li><code>use_bias</code>：Boolean,表示该层是否使用偏差.</li></ul><div class="language-python line-numbers-mode"><pre><code>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;relu&#39;</span><span class="token punctuation">)</span>
layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;softmax&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="conv2d-卷积层" tabindex="-1">Conv2D 卷积层 <a class="header-anchor" href="#conv2d-卷积层" aria-hidden="true">#</a></h4><p><a href="https://www.w3cschool.cn/tensorflow_python/tensorflow_python-p6qw2t3y.html" target="_blank" rel="noopener noreferrer">参数</a></p><ul><li><code>filters</code>：整数,输出空间的维数(即卷积中的滤波器数).</li><li><code>kernel_size</code>：2个整数的整数或元组/列表,指定2D卷积窗口的高度和宽度.可以是单个整数,以指定所有空间维度的相同值.</li><li><code>activation</code>：激活功能(可调用),将其设置为“None”以保持线性激活.</li><li><code>padding</code>：可以是&quot;valid&quot;或&quot;same&quot;(不区分大小写).</li></ul><div class="language-python line-numbers-mode"><pre><code>layers<span class="token punctuation">.</span>Conv2D<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;relu&#39;</span><span class="token punctuation">)</span>
layers<span class="token punctuation">.</span>Conv2D<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;relu&#39;</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">&#39;same&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="conv2dtranspose-逆卷积层" tabindex="-1">Conv2DTranspose 逆卷积层 <a class="header-anchor" href="#conv2dtranspose-逆卷积层" aria-hidden="true">#</a></h4><p>相当于卷积的逆运算</p><p><a href="https://tensorflow.google.cn/api_docs/python/tf/keras/layers/Conv2DTranspose" target="_blank" rel="noopener noreferrer">参数</a></p><ul><li><code>filters</code> Integer, the dimensionality of the output space (i.e. the number of output filters in the convolution).</li><li><code>kernel_size</code> An integer or tuple/list of 2 integers, specifying the height and width of the 2D convolution window. Can be a single integer to specify the same value for all spatial dimensions.</li></ul><div class="language-python line-numbers-mode"><pre><code>layers<span class="token punctuation">.</span>Conv2DTranspose<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">&#39;relu&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="maxpool2d-池化层" tabindex="-1">MaxPool2D 池化层 <a class="header-anchor" href="#maxpool2d-池化层" aria-hidden="true">#</a></h4><p><a href="https://tensorflow.google.cn/api_docs/python/tf/keras/layers/MaxPool2D?hl=en" target="_blank" rel="noopener noreferrer">参数</a></p><ul><li><code>pool_size</code>：2个整数的整数或元组/列表：(pool_height,pool_width),用于指定池窗口的大小；可以是单个整数,以指定所有空间维度的相同值.</li><li><code>strides</code>：2个整数的整数或元组/列表,指定池操作的步幅；可以是单个整数,以指定所有空间维度的相同值.</li><li><code>padding</code>：一个字符串；表示填充方法,可以是“valid”或“same”,不用区分大小写.</li></ul><div class="language-python line-numbers-mode"><pre><code>layers<span class="token punctuation">.</span>MaxPool2D<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="upsampling2d-上采样层" tabindex="-1">UpSampling2D 上采样层 <a class="header-anchor" href="#upsampling2d-上采样层" aria-hidden="true">#</a></h4><p>上采样，相当于池化的逆运算</p><p><a href="https://tensorflow.google.cn/api_docs/python/tf/keras/layers/UpSampling2D?hl=en" target="_blank" rel="noopener noreferrer">参数</a></p><ul><li><code>size</code> Int, or tuple of 2 integers. The upsampling factors for rows and columns.</li></ul><div class="language-python line-numbers-mode"><pre><code>layers<span class="token punctuation">.</span>UpSampling2D<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="reshape" tabindex="-1">Reshape <a class="header-anchor" href="#reshape" aria-hidden="true">#</a></h4><p>将输入重塑为给定形状的层。</p><p><a href="https://tensorflow.google.cn/api_docs/python/tf/keras/layers/Reshape?hl=enl" target="_blank" rel="noopener noreferrer">参数</a></p><ul><li><code>target_shape</code> Tuple of integers, does not include the samples dimension (batch size).</li></ul><div class="language-python line-numbers-mode"><pre><code>layers<span class="token punctuation">.</span>Reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="dropout" tabindex="-1">Dropout <a class="header-anchor" href="#dropout" aria-hidden="true">#</a></h4><p>Dropout层在训练时间内，每一步都会随机将输入单位设置为0，频率为rate，这有助于防止过拟合。未设置为0的输入会被放大1/(1-rate)，这样所有输入的总和就不会改变。</p><p><a href="https://tensorflow.google.cn/api_docs/python/tf/keras/layers/Dropout?hl=en" target="_blank" rel="noopener noreferrer">参数</a></p><ul><li><code>rate</code>：退出率,介于0和1之间；例如rate=0.1,输出单位将减少10％.</li></ul><div class="language-python line-numbers-mode"><pre><code>layers<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="其他" tabindex="-1">其他 <a class="header-anchor" href="#其他" aria-hidden="true">#</a></h4><p>见 <a href="https://tensorflow.google.cn/api_docs/python/tf/keras/layers?hl=enl" target="_blank" rel="noopener noreferrer">Google 官方文档</a></p><h3 id="常用工具函数" tabindex="-1">常用工具函数 <a class="header-anchor" href="#常用工具函数" aria-hidden="true">#</a></h3><h4 id="模型结构表和模型结构图" tabindex="-1">模型结构表和模型结构图 <a class="header-anchor" href="#模型结构表和模型结构图" aria-hidden="true">#</a></h4><div class="language-python line-numbers-mode"><pre><code>model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>
keras<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>plot_model<span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">&#39;mnist_model.png&#39;</span><span class="token punctuation">)</span>
keras<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>plot_model<span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">&#39;model_info.png&#39;</span><span class="token punctuation">,</span> show_shapes<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="参考示例" tabindex="-1">参考示例 <a class="header-anchor" href="#参考示例" aria-hidden="true">#</a></h2><p><a href="https://github.com/czy36mengfei/tensorflow2_tutorials_chinese" target="_blank" rel="noopener noreferrer">tensorflow2中文教程</a></p></div></div><div class="content nav"><span><a href="/posts/d3-note.html"><i class="fa fa-angle-left"></i> d3.js 学习笔记</a></span><span><a href="/posts/python-opencv.html">python opencv rtsp 直播流处理 跳帧与延迟控制 <i class="fa fa-angle-right"></i></a></span></div><div id="waline"></div><div class="toc"><ol><!--[--><li class="h2 active"><a href="#使用-pip-安装-tensorflow">使用 pip 安装 TensorFlow</a></li><li class="h3"><a href="#_1-环境准备">1. 环境准备</a></li><li class="h3"><a href="#_2-创建虚拟环境（推荐）">2. 创建虚拟环境（推荐）</a></li><li class="h3"><a href="#_3-安装-tensorflow-pip-软件包">3. 安装 TensorFlow pip 软件包</a></li><li class="h2"><a href="#tensorflow2-快速入门">TensorFlow2 快速入门</a></li><li class="h3"><a href="#_1-模型构建">1. 模型构建</a></li><li class="h3"><a href="#_2-参数配置">2. 参数配置</a></li><li class="h3"><a href="#_3-训练和评估">3. 训练和评估</a></li><li class="h3"><a href="#_4-构建复杂模型">4. 构建复杂模型</a></li><li class="h3"><a href="#_5-模型保存与恢复">5. 模型保存与恢复</a></li><li class="h2"><a href="#常用函数速查">常用函数速查</a></li><li class="h3"><a href="#常用-layer">常用 Layer</a></li><li class="h3"><a href="#常用工具函数">常用工具函数</a></li><li class="h2"><a href="#参考示例">参考示例</a></li><!--]--></ol></div></div><!--]--></main><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"index.md\":\"a03c7b0e\",\"posts_algorithm-2048.md\":\"5c2e9e66\",\"posts_ascii-art.md\":\"ffd823c1\",\"posts_calc-demo.md\":\"89b321ef\",\"posts_call-cpp-from-python.md\":\"2af82d4b\",\"posts_cpp-promise.md\":\"5e2d54cc\",\"posts_d3-note.md\":\"855cf20e\",\"posts_fix-matplotlib-chinese.md\":\"28cbc526\",\"posts_indexeddb.md\":\"d5ec219e\",\"posts_love2d-require-c-library.md\":\"c057cbfd\",\"posts_new-to-arch.md\":\"72f4c10a\",\"posts_pattern-recognition-note.md\":\"23283799\",\"posts_pyside2-quick-start.md\":\"eb870d5d\",\"posts_python-opencv.md\":\"eb253df5\",\"posts_ripple-animation.md\":\"17970ef6\",\"posts_rust-list-slice.md\":\"ae53454e\",\"posts_tensorflow-note.md\":\"05b29c1d\",\"posts_tetris-field-compress.md\":\"9e3c5af1\",\"posts_write-code-from-answer.md\":\"f4f6cee0\",\"posts_xjb-utils.md\":\"f03eefac\",\"readme.md\":\"fef40110\",\"tags_index.md\":\"6d1ee352\"}")</script>
    <script type="module" async src="/assets/app.a584d98d.js"></script>
    
  </body>
</html>